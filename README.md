# Decentralized File Storage (DS)

åŸºäº IPFS (Helia) å’Œ Fastify æ„å»ºçš„ç°ä»£åŒ–å»ä¸­å¿ƒåŒ–æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿã€‚æä¾›ç²¾ç¾çš„ Web ç•Œé¢ï¼Œæ”¯æŒå¤šç”¨æˆ·ç®¡ç†ã€æƒé™æ§åˆ¶ã€æ ‡ç­¾ç³»ç»Ÿä»¥åŠå¼ºå¤§çš„åå°ç®¡ç†åŠŸèƒ½ã€‚

è‡´åŠ›äºæ‰“é€ å®‰å…¨ã€ç§å¯†ä¸”æ˜“ç”¨çš„å»ä¸­å¿ƒåŒ–å­˜å‚¨ä½“éªŒã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

*   **å»ä¸­å¿ƒåŒ–æ ¸å¿ƒ**ï¼šåŸºäº [Helia](https://github.com/ipfs/helia) (IPFS)ï¼Œæ–‡ä»¶å†…å®¹å»ä¸­å¿ƒåŒ–å¯»å€ï¼Œæ°¸ä¸ä¸¢å¤±ã€‚
*   **ç°ä»£åŒ– UI**ï¼šä½¿ç”¨ Vue 3 (ESM) + Tailwind CSS æ„å»ºï¼Œæ‹¥æœ‰ç²¾ç¾çš„ç»ç’ƒæ‹Ÿæ€é£æ ¼ç•Œé¢ï¼Œé€‚é… PC å’Œç§»åŠ¨ç«¯ã€‚
*   **å¤šç”¨æˆ·ä½“ç³»**ï¼š
    *   æ”¯æŒç”¨æˆ·æ³¨å†Œ/ç™»å½• (JWT è®¤è¯)ã€‚
    *   **è§’è‰²ç®¡ç†**ï¼šæ”¯æŒæ™®é€šç”¨æˆ·ã€ç®¡ç†å‘˜ (Admin) å’Œè¶…çº§ç®¡ç†å‘˜ (Super Admin)ã€‚
    *   **æƒé™æ§åˆ¶**ï¼š
        *   **ç§å¯†/å…¬å¼€**ï¼šç”¨æˆ·å¯å°†æ–‡ä»¶è®¾ä¸ºä»…è‡ªå·±å¯è§æˆ–å…¬å¼€åˆ†äº«ã€‚
        *   **è¶…çº§ç®¡ç†å‘˜æƒé™**ï¼šå¯æŸ¥çœ‹ç³»ç»Ÿå†…æ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬ç§å¯†æ–‡ä»¶ï¼‰ï¼Œå¹¶æ‹¥æœ‰åˆ é™¤ä»»æ„ç”¨æˆ·å’Œæ–‡ä»¶çš„æœ€é«˜æƒé™ã€‚
*   **å¼ºå¤§çš„æ–‡ä»¶ç®¡ç†**ï¼š
    *   **æ‹–æ‹½ä¸Šä¼ **ï¼šæ”¯æŒæ–‡ä»¶åŠæ–‡ä»¶å¤¹æ‹–æ‹½ä¸Šä¼ ï¼ˆè‡ªåŠ¨é€’å½’è§£æï¼‰ã€‚
    *   **æ ‡ç­¾ç³»ç»Ÿ**ï¼šæ”¯æŒä¸ºæ–‡ä»¶æ·»åŠ æ ‡ç­¾ï¼Œå¹¶å¯é€šè¿‡æ ‡ç­¾ç­›é€‰æ–‡ä»¶ã€‚ç®¡ç†å‘˜å¯é…ç½®å…è®¸çš„æ ‡ç­¾åˆ—è¡¨ã€‚
    *   **åœ¨çº¿é¢„è§ˆ**ï¼šæ”¯æŒå›¾ç‰‡ã€ä»£ç ã€æ–‡æœ¬ã€è§†é¢‘ç­‰å¤šç§æ ¼å¼åœ¨çº¿ç›´æ¥é¢„è§ˆã€‚
    *   **ä¸€é”®åˆ†äº«**ï¼šå¿«é€Ÿå¤åˆ¶ CID æˆ–ä¸‹è½½é“¾æ¥ã€‚
*   **åå°ç®¡ç†é¢æ¿**ï¼š
    *   **ç”¨æˆ·ç®¡ç†**ï¼šæŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ï¼Œå°ç¦/è§£å°ç”¨æˆ·ï¼Œæå‡ç”¨æˆ·ä¸ºç®¡ç†å‘˜ï¼Œåˆ é™¤ç”¨æˆ·ï¼ˆä»…é™è¶…çº§ç®¡ç†å‘˜ï¼‰ã€‚
    *   **ç³»ç»Ÿè®¾ç½®**ï¼šé…ç½®æ³¨å†Œç­–ç•¥ï¼ˆå¼€æ”¾/å…³é—­/é‚€è¯·/å®¡æ ¸ï¼‰ã€å…è®¸çš„æ–‡ä»¶åç¼€ã€æœ€å¤§æ–‡ä»¶å¤§å°ã€å…è®¸çš„æ ‡ç­¾ç­‰ã€‚
    *   **é‚€è¯·ç ç®¡ç†**ï¼šç”Ÿæˆå’Œç®¡ç†æ³¨å†Œé‚€è¯·ç ã€‚
*   **é«˜æ€§èƒ½åç«¯**ï¼š
    *   åŸºäº [Bun](https://bun.sh) è¿è¡Œæ—¶å’Œ [Fastify](https://fastify.dev) æ¡†æ¶ã€‚
    *   ä½¿ç”¨ SQLite å­˜å‚¨å…ƒæ•°æ®ï¼Œè½»é‡é«˜æ•ˆã€‚

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

*   **Runtime**: [Bun](https://bun.sh)
*   **Backend**: Fastify, @fastify/jwt, @fastify/multipart, SQLite (bun:sqlite)
*   **Storage**: Helia (IPFS), Blockstore/Datastore FS
*   **Frontend**: Vue 3 (ESM via Import Map), Tailwind CSS (CDN), Native HTML5 Drag & Drop API

## ğŸš€ å¿«é€Ÿå¼€å§‹ (æœ¬åœ°å¼€å‘)

### å‰ææ¡ä»¶

è¯·ç¡®ä¿å·²å®‰è£… [Bun](https://bun.sh)ã€‚

### å®‰è£…

1.  å…‹éš†ä»“åº“ï¼š
    ```bash
    git clone <repository-url>
    cd decentralized-file-storage
    ```

2.  å®‰è£…ä¾èµ–ï¼š
    ```bash
    bun install
    ```

### è¿è¡Œ

1.  å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š
    ```bash
    bun run dev
    ```
    æˆ–è€…ç”Ÿäº§æ¨¡å¼ï¼š
    ```bash
    bun start
    ```

2.  è®¿é—®ï¼šæ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:5678` (é»˜è®¤ç«¯å£å·²æ”¹ä¸º 5678)

## ğŸ§ Linux ç¯å¢ƒéƒ¨ç½²æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ åœ¨ Linux æœåŠ¡å™¨ï¼ˆå¦‚ Ubuntu/Debian/CentOSï¼‰ä¸Šéƒ¨ç½²è¯¥æœåŠ¡ï¼Œå¹¶ä½¿ç”¨ PM2 è¿›è¡Œè¿›ç¨‹å®ˆæŠ¤ã€‚

### 1. å®‰è£… Bun

å¦‚æœæœåŠ¡å™¨å°šæœªå®‰è£… Bunï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š

```bash
curl -fsSL https://bun.sh/install | bash
```

å®‰è£…å®Œæˆåï¼Œè¯·æ ¹æ®æç¤ºå°† `bun` æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ï¼ˆé€šå¸¸éœ€è¦ source ä¸€ä¸‹ `~/.bashrc` æˆ–é‡å¯ç»ˆç«¯ï¼‰ã€‚

### 2. å®‰è£… PM2

ä½¿ç”¨ `bun` æˆ– `npm` å…¨å±€å®‰è£… PM2ï¼š

```bash
bun add -g pm2
# æˆ–è€…
npm install -g pm2
```

### 3. è·å–ä»£ç å¹¶å®‰è£…ä¾èµ–

```bash
git clone <repository-url>
cd decentralized-file-storage
bun install
```

### 4. ä½¿ç”¨ PM2 å¯åŠ¨æœåŠ¡

é¡¹ç›®å·²å†…ç½®é€‚é… Bun çš„ PM2 å¯åŠ¨è„šæœ¬ã€‚åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œï¼š

```bash
bun run pm2:start
```

æ­¤å‘½ä»¤ä¼šä½¿ç”¨ `bun` ä½œä¸ºè§£é‡Šå™¨å¯åŠ¨æœåŠ¡ï¼Œè¿›ç¨‹åä¸º `drpy-node-house`ã€‚

**å¸¸ç”¨ç®¡ç†å‘½ä»¤ï¼š**

*   **æŸ¥çœ‹çŠ¶æ€**ï¼š`bun run pm2:logs` æˆ– `pm2 status`
*   **åœæ­¢æœåŠ¡**ï¼š`bun run pm2:stop`
*   **é‡å¯æœåŠ¡**ï¼š`bun run pm2:restart`
*   **åˆ é™¤æœåŠ¡**ï¼š`bun run pm2:delete`
*   **æŸ¥çœ‹æ—¥å¿—**ï¼š`pm2 logs drpy-node-house`

### 5. é…ç½®ç«¯å£ä¸ä¸»æœº

é»˜è®¤é…ç½®ä¸‹ï¼ŒæœåŠ¡ç›‘å¬ `[::]:5678` (æ”¯æŒ IPv6/IPv4)ã€‚
å¦‚éœ€ä¿®æ”¹ï¼Œè¯·ç¼–è¾‘ `src/config.js` æ–‡ä»¶ï¼Œæˆ–è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
PORT=8080 bun run pm2:start
```

## ğŸ‘‘ è§’è‰²ä¸æƒé™ç®¡ç†

ç³»ç»ŸåŒ…å«ä¸‰ç§è§’è‰²ï¼š
1.  **User (æ™®é€šç”¨æˆ·)**ï¼šä¸Šä¼ ã€ç®¡ç†è‡ªå·±çš„æ–‡ä»¶ã€‚
2.  **Admin (ç®¡ç†å‘˜)**ï¼šè¿›å…¥åå°ç®¡ç†ï¼Œç®¡ç†ç”¨æˆ·çŠ¶æ€ï¼ˆå°ç¦/è§£å°ï¼‰ï¼Œé…ç½®ç³»ç»Ÿè®¾ç½®ï¼Œç®¡ç†é‚€è¯·ç ã€‚
3.  **Super Admin (è¶…çº§ç®¡ç†å‘˜)**ï¼šæ‹¥æœ‰ Admin çš„æ‰€æœ‰æƒé™ï¼Œé¢å¤–æ”¯æŒ**æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·çš„æ–‡ä»¶**ã€**åˆ é™¤ç”¨æˆ·**ã€‚

### å¦‚ä½•è®¾ç½®è¶…çº§ç®¡ç†å‘˜

é¡¹ç›®æä¾›äº†ä¸€ä¸ªç®¡ç†è„šæœ¬ï¼Œç”¨äºæ‰‹åŠ¨æå‡ç”¨æˆ·è§’è‰²ã€‚

1.  é¦–å…ˆæ³¨å†Œä¸€ä¸ªæ™®é€šç”¨æˆ·ï¼ˆä¾‹å¦‚ç”¨æˆ·åï¼š`admin`ï¼‰ã€‚
2.  åœ¨æœåŠ¡å™¨ç»ˆç«¯è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
bun scripts/manage_roles.js list

# å°†ç”¨æˆ·è®¾ç½®ä¸ºè¶…çº§ç®¡ç†å‘˜
bun scripts/manage_roles.js set <username> super_admin
# ä¾‹å¦‚ï¼šbun scripts/manage_roles.js set admin super_admin
```

è®¾ç½®å®Œæˆåï¼Œé‡æ–°ç™»å½•è¯¥è´¦å·å³å¯è·å¾—è¶…çº§ç®¡ç†å‘˜æƒé™ã€‚

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ public/             # å‰ç«¯é™æ€èµ„æº (Vue, Tailwind)
â”‚   â”œâ”€â”€ index.html      # ç”¨æˆ·ä¸»é¡µ
â”‚   â”œâ”€â”€ admin.html      # åå°ç®¡ç†é¡µ
â”‚   â””â”€â”€ js/             # å‰ç«¯é€»è¾‘
â”œâ”€â”€ src/                # åç«¯æºç 
â”‚   â”œâ”€â”€ app.js          # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.js       # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ db.js           # SQLite æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”œâ”€â”€ ipfs.js         # Helia IPFS èŠ‚ç‚¹å°è£…
â”‚   â”œâ”€â”€ routes/         # API è·¯ç”± (Auth, Files, Admin)
â”‚   â””â”€â”€ services/       # ä¸šåŠ¡é€»è¾‘å±‚
â”œâ”€â”€ scripts/            # ç®¡ç†è„šæœ¬
â”‚   â””â”€â”€ manage_roles.js # è§’è‰²ç®¡ç†å·¥å…·
â”œâ”€â”€ data/               # æ•°æ®å­˜å‚¨ (SQLite & IPFS repo)
â””â”€â”€ package.json
```

## ğŸ“ API æ¥å£æ¦‚è§ˆ

*   **Auth**: `/api/auth/register`, `/api/auth/login`
*   **Files**:
    *   `GET /api/files/list` - è·å–æ–‡ä»¶åˆ—è¡¨ (æ”¯æŒåˆ†é¡µã€æœç´¢ã€æ ‡ç­¾ç­›é€‰)
    *   `POST /api/files/upload` - ä¸Šä¼ æ–‡ä»¶
    *   `GET /api/files/download/:cid` - ä¸‹è½½/é¢„è§ˆ
    *   `DELETE /api/files/:cid` - åˆ é™¤æ–‡ä»¶
    *   `POST /api/files/:cid/toggle-visibility` - åˆ‡æ¢å¯è§æ€§
    *   `PUT /api/files/:cid/tags` - æ›´æ–°æ ‡ç­¾
*   **Admin**:
    *   `GET /api/admin/users` - ç”¨æˆ·åˆ—è¡¨
    *   `PUT /api/admin/users/:id` - æ›´æ–°ç”¨æˆ·çŠ¶æ€/è§’è‰²
    *   `DELETE /api/admin/users/:id` - åˆ é™¤ç”¨æˆ· (Super Admin)
    *   `GET/PUT /api/admin/settings` - ç³»ç»Ÿè®¾ç½®
    *   `GET/POST/DELETE /api/admin/invites` - é‚€è¯·ç ç®¡ç†

## ğŸ“„ License

ISC
